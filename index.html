<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文学知识问答挑战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#EC4899',
                        neutral: '#1F2937',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .modal-backdrop {
                backdrop-filter: blur(3px);
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            .pulse-soft {
                animation: pulse-soft 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            @keyframes pulse-soft {
                0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
                100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
            }
            .rank-gold {
                background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            }
            .rank-silver {
                background: linear-gradient(135deg, #E0E0E0 0%, #A9A9A9 100%);
            }
            .rank-bronze {
                background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- 开始界面 -->
        <div id="start-screen" class="text-center py-10">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-6">文学知识问答</h1>
            <p class="text-gray-600 mb-8">挑战你的文学素养，测试对经典文学的了解程度！</p>
            
            <div class="relative h-56 mb-10 rounded-xl overflow-hidden shadow-lg">
                <img src="https://picsum.photos/id/24/800/500" alt="书架上的经典文学书籍" class="w-full h-full object-cover">
            </div>
            
            <button id="start-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300">
                开始挑战 <i class="fa fa-arrow-right ml-2"></i>
            </button>
            <button id="ranking-btn" class="mt-4 bg-white hover:bg-gray-50 text-primary font-bold py-2 px-6 rounded-full transition-all duration-300 border border-primary">
                <i class="fa fa-trophy mr-1"></i> 查看排行榜
            </button>
            <p class="mt-4 text-sm text-gray-500">规则：共20题 | 答对+10分 | 答错-5分 | 3题后需关注公众号 | 负分需分享</p>
        </div>

        <!-- 游戏界面 -->
        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-6 p-3 bg-white/80 backdrop-blur-sm rounded-lg shadow-md">
                <div>
                    <span class="text-gray-600">题目:</span>
                    <span id="question-count" class="font-bold text-primary">1/20</span>
                </div>
                <div>
                    <span class="text-gray-600">得分:</span>
                    <span id="score" class="font-bold text-secondary">0</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 id="question" class="text-xl font-bold mb-5"></h2>
                <div id="options" class="space-y-3">
                    <!-- 选项将动态生成 -->
                </div>
                
                <!-- 增强版答案提示按钮 -->
                <div class="mt-5 text-center">
                    <button id="hint-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-full text-sm transition-all duration-300 flex items-center justify-center mx-auto pulse-soft">
                        <i class="fa fa-lightbulb-o mr-2 text-yellow-200"></i> 提示 (剩余: <span id="hint-count" class="ml-1 font-bold">2</span>)
                    </button>
                    <p class="text-xs text-blue-500 mt-2">点击获取答案线索</p>
                </div>
            </div>

            <div id="feedback" class="hidden p-3 rounded-lg mb-6 text-center"></div>
        </div>

        <!-- 结束界面 -->
        <div id="end-screen" class="hidden text-center py-6">
            <h2 class="text-2xl font-bold text-primary mb-3">挑战完成！</h2>
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <p class="text-gray-600 mb-1">你的最终得分</p>
                <p id="final-score" class="text-4xl font-bold text-secondary mb-3">0</p>
                
                <div class="mb-4">
                    <button id="save-score-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 mr-2">
                        <i class="fa fa-save mr-1"></i> 保存成绩
                    </button>
                    <button id="ranking-end-btn" class="bg-white hover:bg-gray-50 text-primary font-bold py-2 px-6 rounded-full transition-all duration-300 border border-primary">
                        <i class="fa fa-trophy mr-1"></i> 查看排名
                    </button>
                </div>
                
                <button id="restart-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300">
                    再次挑战 <i class="fa fa-refresh ml-1"></i>
                </button>
            </div>
        </div>

        <!-- 排行榜界面 -->
        <div id="ranking-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="back-from-ranking-btn" class="text-primary hover:text-primary/80 font-medium transition-colors">
                    <i class="fa fa-arrow-left mr-1"></i> 返回
                </button>
                <h2 class="text-2xl font-bold text-primary">分数排行榜</h2>
                <div class="w-8"></div> <!-- 占位元素，保持居中 -->
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <!-- 前三名展示 -->
                <div class="flex justify-center items-end mb-10">
                    <!-- 第二名 -->
                    <div class="text-center w-1/3">
                        <div class="rank-silver w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-md">
                            2
                        </div>
                        <p class="font-medium" id="rank-2-name">张三</p>
                        <p class="text-secondary font-bold" id="rank-2-score">180</p>
                    </div>
                    
                    <!-- 第一名 -->
                    <div class="text-center w-1/3 transform translate-y-[-20px]">
                        <div class="rank-gold w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold shadow-md">
                            1
                        </div>
                        <p class="font-medium" id="rank-1-name">李四</p>
                        <p class="text-secondary font-bold" id="rank-1-score">190</p>
                    </div>
                    
                    <!-- 第三名 -->
                    <div class="text-center w-1/3">
                        <div class="rank-bronze w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-md">
                            3
                        </div>
                        <p class="font-medium" id="rank-3-name">王五</p>
                        <p class="text-secondary font-bold" id="rank-3-score">170</p>
                    </div>
                </div>
                
                <!-- 其他排名 -->
                <div class="space-y-3" id="other-ranks">
                    <!-- 排名将动态生成 -->
                </div>
                
                <!-- 我的排名 -->
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <div class="flex items-center justify-between bg-purple-50 p-3 rounded-lg" id="my-rank">
                        <div class="flex items-center">
                            <span class="w-6 h-6 rounded-full bg-primary text-white text-center text-xs font-bold mr-3 flex items-center justify-center">--</span>
                            <span class="font-medium">我</span>
                        </div>
                        <span class="text-secondary font-bold" id="my-score">0</span>
                    </div>
                </div>
                
                <div class="mt-4 text-xs text-gray-500 text-center">
                    <p>排行榜数据存储在本地，仅在当前设备可见</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 关注公众号模态框 -->
    <div id="follow-modal" class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden">
            <div class="bg-primary text-white p-5 text-center">
                <i class="fa fa-book text-2xl mb-2"></i>
                <h3 class="text-xl font-bold">文青竞技场！解锁完整题库</h3>
                <p class="opacity-90 text-sm mt-1">敢闯3题还不够！真正的文学爱好者从不半途而废</p>
            </div>
            
            <div class="p-5">
                <div class="flex flex-col items-center">
                    <!-- 公众号二维码（使用GitHub仓库图片链接） -->
                    <div class="w-48 h-48 bg-gray-100 rounded-lg flex items-center justify-center mb-5 border-4 border-white shadow-md pulse">
                        <img src="https://github.com/guyor3799/guyor3799.github.io/blob/386df2f9d624572b59fec75ea720a498ec7ff0fa/%E5%BE%AE%E4%BF%A1%E5%85%AC%E5%8F%B7.jpg?raw=true" alt="沧海墨客公众号二维码" class="w-full h-full object-contain">
                    </div>
                    
                    <h4 class="text-lg font-bold mb-2">沧海墨客</h4>
                    <p class="text-gray-600 text-center text-sm mb-4">
                        长按二维码关注公众号<br>
                        解锁全部20题，后续高分更能迎好礼，文学造诣等你来证明！
                    </p>
                    
                    <button id="verify-follow-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-full transition-all duration-300">
                        <i class="fa fa-check-circle mr-1"></i> 已关注，继续答题
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 负分分享模态框 -->
    <div id="negative-score-modal" class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden">
            <div class="bg-red-500 text-white p-5 text-center">
                <i class="fa fa-exclamation-triangle text-2xl mb-2"></i>
                <h3 class="text-xl font-bold">分数已不足</h3>
                <p class="opacity-90 text-sm mt-1">分享好友或朋友圈即可继续答题</p>
            </div>
            
            <div class="p-5">
                <div class="flex flex-col items-center space-y-3">
                    <p class="text-gray-600 text-center mb-2">
                        当前分数：<span id="negative-score" class="font-bold text-red-500">-5</span>
                    </p>
                    
                    <button id="share-friend-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-weixin mr-2"></i> 分享给好友
                    </button>
                    
                    <button id="share-moments-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-commenting-o mr-2"></i> 分享到朋友圈
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 作弊提示模态框 -->
    <div id="cheat-modal" class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden">
            <div class="bg-orange-500 text-white p-5 text-center">
                <i class="fa fa-warning text-2xl mb-2"></i>
                <h3 class="text-xl font-bold">检测到异常操作</h3>
            </div>
            
            <div class="p-5">
                <div class="flex flex-col items-center text-center">
                    <p id="cheat-message" class="text-gray-700 mb-5">分享未成功，请重新分享</p>
                    <p class="text-red-500 font-bold mb-4">已扣除10分</p>
                    
                    <button id="confirm-cheat-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-full transition-all duration-300">
                        确认并重新分享
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示模态框（增强版） -->
    <div id="hint-modal" class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden transform transition-all">
            <div class="bg-blue-500 text-white p-5 text-center">
                <i class="fa fa-lightbulb-o text-3xl mb-2 text-yellow-200 pulse"></i>
                <h3 class="text-xl font-bold">答案提示</h3>
                <p class="text-sm opacity-90 mt-1">这是一个重要线索哦！</p>
            </div>
            
            <div class="p-6">
                <div class="flex flex-col items-center text-center">
                    <div class="bg-blue-50 rounded-xl p-4 mb-5 w-full">
                        <p id="hint-content" class="text-gray-700 text-lg">这是一个提示信息</p>
                    </div>
                    
                    <p class="text-sm text-gray-500 mb-5">
                        剩余提示次数: <span id="hint-remaining" class="font-bold text-blue-500">1</span>
                    </p>
                    
                    <button id="close-hint-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full transition-all duration-300">
                        知道了，继续答题
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 保存成绩模态框 -->
    <div id="save-score-modal" class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden">
            <div class="bg-primary text-white p-5 text-center">
                <i class="fa fa-trophy text-2xl mb-2"></i>
                <h3 class="text-xl font-bold">保存你的成绩</h3>
            </div>
            
            <div class="p-5">
                <div class="mb-4">
                    <label for="username" class="block text-gray-700 text-sm font-medium mb-2">你的昵称</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入你的昵称">
                </div>
                
                <p class="text-center text-gray-600 mb-4">
                    你的得分: <span id="score-to-save" class="font-bold text-secondary">0</span>
                </p>
                
                <button id="confirm-save-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-full transition-all duration-300">
                    确认保存
                </button>
            </div>
        </div>
    </div>

    <script>
        // 配置参数
        const REQUIRED_FOLLOW_AFTER = 2; // 第3题后强制关注（索引从0开始）
        let lastVisibleTime = new Date().getTime(); // 记录最后可见时间
        let shareStartTime = 0; // 分享开始时间
        const MIN_SHARE_DURATION = 3000; // 最小分享时长(毫秒)
        const RANKING_STORAGE_KEY = "literature_quiz_ranking"; // 本地存储键名
        
        // 从本地存储加载排行榜数据
        function loadRankingData() {
            const savedData = localStorage.getItem(RANKING_STORAGE_KEY);
            if (savedData) {
                try {
                    return JSON.parse(savedData);
                } catch (e) {
                    console.error("加载排行榜数据失败:", e);
                    return [];
                }
            }
            // 如果没有数据，返回默认示例数据
            return [
                { name: "文学大师", score: 200, timestamp: new Date().getTime() - 86400000 * 2 },
                { name: "书香门第", score: 180, timestamp: new Date().getTime() - 86400000 },
                { name: "诗词达人", score: 165, timestamp: new Date().getTime() - 43200000 },
                { name: "文学爱好者", score: 150, timestamp: new Date().getTime() - 36000000 },
                { name: "初学者", score: 120, timestamp: new Date().getTime() - 28800000 }
            ];
        }
        
        // 保存排行榜数据到本地存储
        function saveRankingData(data) {
            try {
                localStorage.setItem(RANKING_STORAGE_KEY, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error("保存排行榜数据失败:", e);
                return false;
            }
        }
        
        // 排行榜数据（从本地存储加载）
        let rankingData = loadRankingData();
        
        // 当前用户数据
        let currentUser = {
            name: "",
            score: 0,
            hasSaved: false
        };
        
        // 完整的20道题题库
        const questions = [
            {
                question: "《红楼梦》的作者是谁？",
                options: ["吴承恩", "曹雪芹", "罗贯中", "施耐庵"],
                correct: 1,
                hint: "这位作者生活在清代，家族曾显赫一时，作品被誉为中国古典小说巅峰之作"
            },
            {
                question: "下列哪部作品不属于莎士比亚的四大悲剧？",
                options: ["哈姆雷特", "罗密欧与朱丽叶", "麦克白", "李尔王"],
                correct: 1,
                hint: "这部作品虽然是悲剧，但通常不被列入四大悲剧，它讲述了两个年轻恋人的故事"
            },
            {
                question: "《西游记》中，孙悟空的第一个师傅是谁？",
                options: ["唐僧", "如来佛祖", "菩提祖师", "观音菩萨"],
                correct: 2,
                hint: "这位师傅教会了孙悟空七十二变和筋斗云，但后来不让孙悟空提及他的名字"
            },
            {
                question: "鲁迅的第一篇白话小说是什么？",
                options: ["《阿Q正传》", "《狂人日记》", "《药》", "《祝福》"],
                correct: 1,
                hint: "这篇小说发表于1918年，描写了一个“狂人”的视角，批判了封建礼教"
            },
            {
                question: "下列哪位诗人不属于“唐宋八大家”？",
                options: ["苏轼", "李白", "王安石", "柳宗元"],
                correct: 1,
                hint: "这位诗人是唐代著名的浪漫主义诗人，被称为“诗仙”，以诗歌著称而非散文"
            },
            {
                question: "《三国演义》中，“桃园三结义”的三位人物不包括？",
                options: ["刘备", "关羽", "赵云", "张飞"],
                correct: 2,
                hint: "这位人物是蜀汉名将，跟随刘备，但并不是桃园结义的成员"
            },
            {
                question: "《水浒传》中，绰号为“及时雨”的是谁？",
                options: ["林冲", "宋江", "吴用", "李逵"],
                correct: 1,
                hint: "他是梁山泊的首领，为人仗义疏财，经常在别人危难时伸出援手"
            },
            {
                question: "下列哪部作品是老舍的代表作？",
                options: ["《家》", "《骆驼祥子》", "《雷雨》", "《围城》"],
                correct: 1,
                hint: "这部小说描写了20世纪20年代北平一个人力车夫的悲惨命运"
            },
            {
                question: "《诗经》分为风、雅、颂三类，其中“风”指的是什么？",
                options: ["宫廷乐歌", "宗庙祭祀乐歌", "各地民歌", "文人诗作"],
                correct: 2,
                hint: "“风”共有160篇，收集了周南、召南等15个地区的歌曲"
            },
            {
                question: "下列哪位作家获得过诺贝尔文学奖？",
                options: ["鲁迅", "茅盾", "莫言", "巴金"],
                correct: 2,
                hint: "这位作家以魔幻现实主义融合民间故事、历史与当代的作品而闻名，代表作有《红高粱家族》"
            },
            {
                question: "《荷塘月色》的作者是谁？",
                options: ["朱自清", "冰心", "徐志摩", "郭沫若"],
                correct: 0,
                hint: "这位作家是现代著名的散文家、诗人，其作品语言优美，情感真挚"
            },
            {
                question: "“大江东去，浪淘尽，千古风流人物”出自哪位词人之手？",
                options: ["辛弃疾", "李清照", "苏轼", "柳永"],
                correct: 2,
                hint: "这位词人是北宋时期的文学巨匠，号东坡居士，是豪放派的代表人物"
            },
            {
                question: "下列哪部作品是巴金的“激流三部曲”之一？",
                options: ["《雾》", "《雨》", "《电》", "《家》"],
                correct: 3,
                hint: "这部小说描写了一个封建大家庭的衰落和青年一代的觉醒"
            },
            {
                question: "“床前明月光，疑是地上霜”出自李白的哪首诗？",
                options: ["《望庐山瀑布》", "《静夜思》", "《月下独酌》", "《将进酒》"],
                correct: 1,
                hint: "这首诗表达了诗人的思乡之情，是一首脍炙人口的短诗"
            },
            {
                question: "《雷雨》的作者是谁？",
                options: ["曹禺", "田汉", "夏衍", "老舍"],
                correct: 0,
                hint: "这位剧作家是中国现代话剧的奠基人之一，这部作品是他的代表作之一"
            },
            {
                question: "下列哪部作品不属于“四大名著”？",
                options: ["《三国演义》", "《金瓶梅》", "《西游记》", "《红楼梦》"],
                correct: 1,
                hint: "这部小说成书于明代，虽然影响力很大，但通常不被列入四大名著"
            },
            {
                question: "“横眉冷对千夫指，俯首甘为孺子牛”是谁的诗句？",
                options: ["郭沫若", "鲁迅", "茅盾", "闻一多"],
                correct: 1,
                hint: "这位作家是中国现代文学的奠基人之一，作品具有强烈的批判精神"
            },
            {
                question: "《边城》的作者是谁？",
                options: ["沈从文", "钱钟书", "郁达夫", "丁玲"],
                correct: 0,
                hint: "这位作家以描写湘西地区的风土人情著称，作品风格独特"
            },
            {
                question: "“落霞与孤鹜齐飞，秋水共长天一色”出自哪篇文章？",
                options: ["《滕王阁序》", "《岳阳楼记》", "《醉翁亭记》", "《兰亭集序》"],
                correct: 0,
                hint: "这篇文章是唐代文学家王勃的代表作，写于滕王阁的一次宴会上"
            },
            {
                question: "《围城》的作者是谁？",
                options: ["茅盾", "巴金", "钱钟书", "沈从文"],
                correct: 2,
                hint: "这部小说被誉为“新儒林外史”，作者是中国现代著名学者和作家"
            }
        ];
        
        // 游戏状态
        const gameState = {
            currentQuestion: 0,
            score: 0,
            hintsUsed: 0,
            maxHints: 2,
            hasFollowed: false,
            isGameOver: false
        };
        
        // DOM 元素
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const rankingScreen = document.getElementById('ranking-screen');
        
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const rankingBtn = document.getElementById('ranking-btn');
        const rankingEndBtn = document.getElementById('ranking-end-btn');
        const backFromRankingBtn = document.getElementById('back-from-ranking-btn');
        
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const questionCountElement = document.getElementById('question-count');
        const scoreElement = document.getElementById('score');
        const feedbackElement = document.getElementById('feedback');
        const finalScoreElement = document.getElementById('final-score');
        
        const followModal = document.getElementById('follow-modal');
        const verifyFollowBtn = document.getElementById('verify-follow-btn');
        
        const negativeScoreModal = document.getElementById('negative-score-modal');
        const negativeScoreElement = document.getElementById('negative-score');
        const shareFriendBtn = document.getElementById('share-friend-btn');
        const shareMomentsBtn = document.getElementById('share-moments-btn');
        
        const cheatModal = document.getElementById('cheat-modal');
        const cheatMessageElement = document.getElementById('cheat-message');
        const confirmCheatBtn = document.getElementById('confirm-cheat-btn');
        
        const hintBtn = document.getElementById('hint-btn');
        const hintCountElement = document.getElementById('hint-count');
        const hintModal = document.getElementById('hint-modal');
        const hintContentElement = document.getElementById('hint-content');
        const hintRemainingElement = document.getElementById('hint-remaining');
        const closeHintBtn = document.getElementById('close-hint-btn');
        
        const saveScoreBtn = document.getElementById('save-score-btn');
        const saveScoreModal = document.getElementById('save-score-modal');
        const usernameInput = document.getElementById('username');
        const scoreToSaveElement = document.getElementById('score-to-save');
        const confirmSaveBtn = document.getElementById('confirm-save-btn');
        
        // 排行榜元素
        const rank1Name = document.getElementById('rank-1-name');
        const rank1Score = document.getElementById('rank-1-score');
        const rank2Name = document.getElementById('rank-2-name');
        const rank2Score = document.getElementById('rank-2-score');
        const rank3Name = document.getElementById('rank-3-name');
        const rank3Score = document.getElementById('rank-3-score');
        const otherRanksElement = document.getElementById('other-ranks');
        const myRankElement = document.getElementById('my-rank');
        const myScoreElement = document.getElementById('my-score');
        
        // 初始化事件监听器
        function initEventListeners() {
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
            rankingBtn.addEventListener('click', showRanking);
            rankingEndBtn.addEventListener('click', showRanking);
            backFromRankingBtn.addEventListener('click', hideRanking);
            
            verifyFollowBtn.addEventListener('click', verifyFollow);
            
            shareFriendBtn.addEventListener('click', startShare);
            shareMomentsBtn.addEventListener('click', startShare);
            
            confirmCheatBtn.addEventListener('click', closeCheatModal);
            
            hintBtn.addEventListener('click', showHint);
            closeHintBtn.addEventListener('click', closeHintModal);
            
            saveScoreBtn.addEventListener('click', showSaveScoreModal);
            confirmSaveBtn.addEventListener('click', saveScore);
            
            // 监听页面可见性变化，防止作弊
            document.addEventListener('visibilitychange', handleVisibilityChange);
        }
        
        // 开始游戏
        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.hintsUsed = 0;
            gameState.hasFollowed = false;
            gameState.isGameOver = false;
            updateScore();
            loadQuestion(0);
        }
        
        // 重新开始游戏
        function restartGame() {
            endScreen.classList.add('hidden');
            startGame();
        }
        
        // 加载问题
        function loadQuestion(index) {
            if (index >= questions.length) {
                endGame();
                return;
            }
            
            const question = questions[index];
            questionElement.textContent = question.question;
            optionsElement.innerHTML = '';
            feedbackElement.classList.add('hidden');
            
            questionCountElement.textContent = `${index + 1}/${questions.length}`;
            hintCountElement.textContent = gameState.maxHints - gameState.hintsUsed;
            
            // 随机排序选项，增加难度
            const shuffledOptions = [...question.options];
            const optionIndices = [0, 1, 2, 3];
            optionIndices.sort(() => Math.random() - 0.5);
            
            optionIndices.forEach(i => {
                const button = document.createElement('button');
                button.className = 'w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-purple-50 transition-colors duration-200';
                button.textContent = shuffledOptions[i];
                button.dataset.correct = i === question.correct;
                button.addEventListener('click', () => checkAnswer(button, i === question.correct));
                optionsElement.appendChild(button);
            });
        }
        
        // 检查答案
        function checkAnswer(button, isCorrect) {
            // 禁用所有选项
            const allOptions = optionsElement.querySelectorAll('button');
            allOptions.forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.correct === 'true') {
                    btn.classList.add('bg-green-50', 'border-green-200', 'text-green-700');
                }
            });
            
            // 高亮用户选择
            if (isCorrect) {
                button.classList.add('bg-green-50', 'border-green-200', 'text-green-700');
                showFeedback('正确！+10分', 'bg-green-100 text-green-800');
                gameState.score += 10;
            } else {
                button.classList.add('bg-red-50', 'border-red-200', 'text-red-700');
                showFeedback('错误！-5分', 'bg-red-100 text-red-800');
                gameState.score -= 5;
            }
            
            updateScore();
            
            // 检查分数是否为负
            if (gameState.score < 0) {
                setTimeout(() => {
                    showNegativeScoreModal();
                }, 1500);
                return;
            }
            
            // 检查是否需要关注公众号
            if (gameState.currentQuestion === REQUIRED_FOLLOW_AFTER && !gameState.hasFollowed) {
                setTimeout(() => {
                    showFollowModal();
                }, 1500);
                return;
            }
            
            // 加载下一题
            setTimeout(() => {
                gameState.currentQuestion++;
                loadQuestion(gameState.currentQuestion);
            }, 1500);
        }
        
        // 显示反馈
        function showFeedback(message, className) {
            feedbackElement.textContent = message;
            feedbackElement.className = `p-3 rounded-lg mb-6 text-center ${className}`;
            feedbackElement.classList.remove('hidden');
        }
        
        // 更新分数
        function updateScore() {
            scoreElement.textContent = gameState.score;
            currentUser.score = gameState.score;
        }
        
        // 结束游戏
        function endGame() {
            gameState.isGameOver = true;
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalScoreElement.textContent = gameState.score;
        }
        
        // 显示关注公众号模态框
        function showFollowModal() {
            followModal.classList.remove('hidden');
        }
        
        // 验证关注状态
        function verifyFollow() {
            // 模拟验证过程
            gameState.hasFollowed = true;
            followModal.classList.add('hidden');
            
            // 继续游戏
            gameState.currentQuestion++;
            loadQuestion(gameState.currentQuestion);
        }
        
        // 显示负分分享模态框
        function showNegativeScoreModal() {
            negativeScoreElement.textContent = gameState.score;
            negativeScoreModal.classList.remove('hidden');
            shareStartTime = new Date().getTime();
        }
        
        // 开始分享
        function startShare() {
            // 实际应用中，这里会调用分享API
            // 这里只是模拟分享过程
            setTimeout(() => {
                const shareDuration = new Date().getTime() - shareStartTime;
                if (shareDuration >= MIN_SHARE_DURATION) {
                    // 分享成功，恢复分数并继续游戏
                    gameState.score = 0;
                    updateScore();
                    negativeScoreModal.classList.add('hidden');
                    
                    gameState.currentQuestion++;
                    loadQuestion(gameState.currentQuestion);
                } else {
                    // 分享时间过短，视为作弊
                    gameState.score -= 10;
                    updateScore();
                    negativeScoreModal.classList.add('hidden');
                    showCheatModal("分享时间过短，请至少分享3秒以上");
                }
            }, 1000);
        }
        
        // 显示作弊提示模态框
        function showCheatModal(message) {
            cheatMessageElement.textContent = message;
            cheatModal.classList.remove('hidden');
        }
        
        // 关闭作弊提示模态框
        function closeCheatModal() {
            cheatModal.classList.add('hidden');
            showNegativeScoreModal();
        }
        
        // 显示提示
        function showHint() {
            if (gameState.hintsUsed >= gameState.maxHints) {
                return;
            }
            
            const currentQuestion = questions[gameState.currentQuestion];
            hintContentElement.textContent = currentQuestion.hint;
            hintRemainingElement.textContent = gameState.maxHints - gameState.hintsUsed - 1;
            
            hintModal.classList.remove('hidden');
            gameState.hintsUsed++;
            hintCountElement.textContent = gameState.maxHints - gameState.hintsUsed;
        }
        
        // 关闭提示
        function closeHintModal() {
            hintModal.classList.add('hidden');
        }
        
        // 显示保存成绩模态框
        function showSaveScoreModal() {
            scoreToSaveElement.textContent = gameState.score;
            saveScoreModal.classList.remove('hidden');
        }
        
        // 保存成绩
        function saveScore() {
            const username = usernameInput.value.trim() || '匿名用户';
            currentUser.name = username;
            currentUser.hasSaved = true;
            
            // 添加到排行榜
            rankingData.push({
                name: username,
                score: gameState.score,
                timestamp: new Date().getTime()
            });
            
            // 排序并保留前10名
            rankingData.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
            if (rankingData.length > 10) {
                rankingData = rankingData.slice(0, 10);
            }
            
            // 保存到本地存储
            saveRankingData(rankingData);
            
            saveScoreModal.classList.add('hidden');
            usernameInput.value = '';
            
            // 显示排行榜
            showRanking();
        }
        
        // 显示排行榜
        function showRanking() {
            // 隐藏所有屏幕，显示排行榜
            startScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            rankingScreen.classList.remove('hidden');
            
            // 刷新排行榜数据
            refreshRankingDisplay();
        }
        
        // 隐藏排行榜
        function hideRanking() {
            rankingScreen.classList.add('hidden');
            
            // 返回到之前的屏幕
            if (gameState.isGameOver) {
                endScreen.classList.remove('hidden');
            } else if (gameState.currentQuestion > 0) {
                gameScreen.classList.remove('hidden');
            } else {
                startScreen.classList.remove('hidden');
            }
        }
        
        // 刷新排行榜显示
        function refreshRankingDisplay() {
            // 确保数据已排序
            rankingData.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
            
            // 更新前三名
            if (rankingData.length >= 1) {
                rank1Name.textContent = rankingData[0].name;
                rank1Score.textContent = rankingData[0].score;
            }
            if (rankingData.length >= 2) {
                rank2Name.textContent = rankingData[1].name;
                rank2Score.textContent = rankingData[1].score;
            }
            if (rankingData.length >= 3) {
                rank3Name.textContent = rankingData[2].name;
                rank3Score.textContent = rankingData[2].score;
            }
            
            // 清空其他排名
            otherRanksElement.innerHTML = '';
            
            // 更新其他排名（从第4名开始）
            for (let i = 3; i < rankingData.length; i++) {
                const rankItem = document.createElement('div');
                rankItem.className = 'flex items-center justify-between p-2 border-b border-gray-100 last:border-0';
                
                rankItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-6 h-6 rounded-full bg-gray-200 text-gray-700 text-center text-xs font-bold mr-3 flex items-center justify-center">${i + 1}</span>
                        <span>${rankingData[i].name}</span>
                    </div>
                    <span class="text-secondary font-bold">${rankingData[i].score}</span>
                `;
                
                otherRanksElement.appendChild(rankItem);
            }
            
            // 更新我的排名
            myScoreElement.textContent = currentUser.score;
            
            if (currentUser.hasSaved) {
                // 查找当前用户的排名
                const myRank = rankingData.findIndex(item => 
                    item.name === currentUser.name && 
                    item.score === currentUser.score &&
                    // 考虑时间戳，避免同名同分数的情况
                    Math.abs(item.timestamp - new Date().getTime()) < 5000
                );
                
                if (myRank !== -1) {
                    myRankElement.querySelector('span:first-child').textContent = myRank + 1;
                } else {
                    myRankElement.querySelector('span:first-child').textContent = '10+';
                }
            } else {
                myRankElement.querySelector('span:first-child').textContent = '--';
            }
        }
        
        // 处理页面可见性变化
        function handleVisibilityChange() {
            const currentTime = new Date().getTime();
            
            // 如果页面从不可见变为可见
            if (document.visibilityState === 'visible') {
                // 检查是否在分享过程中作弊
                if (!negativeScoreModal.classList.contains('hidden')) {
                    const hiddenDuration = currentTime - lastVisibleTime;
                    if (hiddenDuration < MIN_SHARE_DURATION) {
                        gameState.score -= 10;
                        updateScore();
                        negativeScoreModal.classList.add('hidden');
                        showCheatModal("检测到异常操作，可能未完成分享");
                    }
                }
            }
            
            lastVisibleTime = currentTime;
        }
        
        // 初始化游戏
        function init() {
            initEventListeners();
        }
        
        // 启动游戏
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>