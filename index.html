<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沧海ke | 文学知识问答</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#EC4899',
                        admin: '#10B981' // 管理员绿色
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .pulse-soft {
                animation: pulse-soft 2s infinite;
            }
            .rank-highlight {
                background-color: rgba(16, 185, 129, 0.05);
                border-color: rgba(16, 185, 129, 0.2);
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1);
            }
        }
        @keyframes pulse-soft {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- 标题区 -->
        <div class="text-center mb-8">
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-primary mb-2">文学知识问答</h1>
            <p class="text-gray-600">挑战你的文学素养，记录你的排名</p>
        </div>

        <!-- 开始界面 -->
        <div id="start-screen" class="text-center py-6">
            <div class="relative h-52 mb-8 rounded-xl overflow-hidden shadow-lg">
                <img src="https://picsum.photos/id/24/800/500" alt="古籍与书法背景" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent flex items-end">
                    <p class="text-white p-4 text-shadow">中华文化 · 经典传承</p>
                </div>
            </div>

            <button id="start-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 mb-4">
                开始挑战 <i class="fa fa-arrow-right ml-2"></i>
            </button>
            <button id="ranking-btn" class="bg-white hover:bg-gray-50 text-primary font-bold py-2 px-6 rounded-full text-base transition-all duration-300 border border-primary/30 mb-6">
                查看排行榜 <i class="fa fa-trophy ml-1"></i>
            </button>

            <!-- 管理员登录入口 -->
            <div class="mt-8">
                <p id="admin-trigger" class="text-xs text-gray-500 cursor-pointer" onclick="toggleAdminLogin()">
                    <i class="fa fa-shield mr-1"></i> 管理员入口（点击显示）
                </p>
                <div id="admin-login" class="hidden mt-4 bg-white p-4 rounded-xl shadow-md border border-admin/20 card-shadow">
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="admin-pwd">管理员密码</label>
                        <input type="password" id="admin-pwd" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50" placeholder="输入管理员密码">
                    </div>
                    <button id="admin-login-btn" class="w-full bg-admin hover:bg-admin/90 text-white py-2 rounded-lg transition-colors pulse-soft">
                        登录查看全用户数据
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-6 p-3 bg-white/80 backdrop-blur-sm rounded-lg shadow-md">
                <div>
                    <span class="text-gray-600">题目:</span>
                    <span id="question-count" class="font-bold text-primary">1/20</span>
                </div>
                <div>
                    <span class="text-gray-600">得分:</span>
                    <span id="score" class="font-bold text-secondary">0</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6 card-shadow">
                <h2 id="question" class="text-xl font-bold mb-5">题目加载中...</h2>
                <div id="options" class="space-y-3">
                    <!-- 选项动态生成 -->
                </div>
            </div>

            <div class="flex justify-between">
                <button id="hint-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-5 rounded-full text-sm transition-all duration-300">
                    提示 (剩余: <span id="hint-count">2</span>)
                </button>
                <button id="quit-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-5 rounded-full text-sm transition-all duration-300">
                    退出
                </button>
            </div>
        </div>

        <!-- 排行榜界面 -->
        <div id="ranking-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-primary">
                    <i class="fa fa-trophy mr-2 text-secondary"></i>排行榜
                </h2>
                <button id="back-btn" class="bg-white hover:bg-gray-50 text-gray-700 font-medium py-1.5 px-4 rounded-lg border border-gray-300 transition-colors">
                    返回
                </button>
            </div>

            <!-- 管理员标识 -->
            <div id="admin-badge" class="hidden mb-4 bg-admin/10 text-admin text-sm font-medium py-1 px-3 rounded-full inline-block">
                <i class="fa fa-user-secret mr-1"></i> 管理员视图（显示所有用户）
            </div>

            <!-- 前三名特殊展示 -->
            <div class="grid grid-cols-3 gap-4 mb-8">
                <!-- 第二名 -->
                <div class="bg-white rounded-xl shadow-md p-4 text-center transform scale-95 card-shadow">
                    <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold text-gray-500">2</div>
                    <p id="rank-2-name" class="font-medium mb-1">暂无用户</p>
                    <p id="rank-2-score" class="text-lg font-bold text-secondary">0</p>
                </div>
                <!-- 第一名 -->
                <div class="bg-white rounded-xl shadow-lg p-5 text-center transform scale-105 card-shadow">
                    <div class="w-14 h-14 mx-auto mb-3 rounded-full bg-yellow-400 flex items-center justify-center text-2xl font-bold text-white">1</div>
                    <p id="rank-1-name" class="font-medium mb-1">暂无用户</p>
                    <p id="rank-1-score" class="text-xl font-bold text-secondary">0</p>
                </div>
                <!-- 第三名 -->
                <div class="bg-white rounded-xl shadow-md p-4 text-center transform scale-90 card-shadow">
                    <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-amber-700 flex items-center justify-center text-2xl font-bold text-white">3</div>
                    <p id="rank-3-name" class="font-medium mb-1">暂无用户</p>
                    <p id="rank-3-score" class="text-lg font-bold text-secondary">0</p>
                </div>
            </div>

            <!-- 排行榜列表 -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden card-shadow">
                <div class="grid grid-cols-4 bg-gray-50 py-2 px-4 font-medium text-gray-600 border-b border-gray-200">
                    <div>排名</div>
                    <div class="col-span-2">用户</div>
                    <div>分数</div>
                </div>
                <div id="ranking-list" class="max-h-[400px] overflow-y-auto">
                    <!-- 排名项动态生成 -->
                    <div class="grid grid-cols-4 py-3 px-4 border-b border-gray-100 text-center">
                        <div class="text-gray-500">--</div>
                        <div class="col-span-2 text-gray-500">暂无排名数据</div>
                        <div class="text-gray-500">--</div>
                    </div>
                </div>
            </div>

            <!-- 管理员操作区 -->
            <div id="admin-actions" class="hidden mt-6 text-center">
                <button id="export-ranking" class="bg-admin hover:bg-admin/90 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    <i class="fa fa-download mr-1"></i> 导出全用户排名数据
                </button>
            </div>
        </div>

        <!-- 结束界面 -->
        <div id="end-screen" class="hidden text-center py-6">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6 card-shadow">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
                    <i class="fa fa-trophy text-2xl text-primary"></i>
                </div>
                <h2 class="text-2xl font-bold text-primary mb-4">挑战完成！</h2>
                <p class="text-lg mb-2">你的最终得分：<span id="final-score" class="font-bold text-secondary">0</span></p>
                <p id="final-rank" class="text-gray-600 mb-6">你的排名：未上榜</p>
                
                <div class="flex flex-col sm:flex-row justify-center gap-3">
                    <button id="save-score-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-colors">
                        保存成绩到排行榜
                    </button>
                    <button id="restart-btn" class="bg-white hover:bg-gray-50 text-primary font-bold py-2 px-6 rounded-full border border-primary/30 transition-colors">
                        重新挑战
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏核心数据
        const RANKING_KEY = 'literature_quiz_ranking';
        const ADMIN_PASSWORD = 'admin123456'; // 管理员密码，实际使用时应修改
        let currentQuestion = 0;
        let score = 0;
        let hintsUsed = 0;
        let isAdmin = false;
        let userScores = JSON.parse(localStorage.getItem(RANKING_KEY)) || [];
        let currentUserName = '';

        // 题库数据
        const questions = [
            {
                question: "《红楼梦》的作者是谁？",
                options: ["罗贯中", "曹雪芹", "吴承恩", "施耐庵"],
                correct: 1
            },
            {
                question: "下列哪个不是唐代诗人？",
                options: ["李白", "杜甫", "苏轼", "王维"],
                correct: 2
            },
            {
                question: "\"床前明月光\"的下一句是？",
                options: ["疑是地上霜", "举头望明月", "低头思故乡", "明月照我还"],
                correct: 0
            },
            {
                question: "《三国演义》中\"桃园三结义\"的三位人物不包括？",
                options: ["刘备", "关羽", "张飞", "赵云"],
                correct: 3
            },
            {
                question: "\"但愿人长久，千里共婵娟\"出自哪位词人？",
                options: ["李清照", "苏轼", "辛弃疾", "柳永"],
                correct: 1
            }
            // 可继续添加更多题目
        ];

        // DOM元素
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const rankingScreen = document.getElementById('ranking-screen');
        const endScreen = document.getElementById('end-screen');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定按钮事件
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('ranking-btn').addEventListener('click', showRanking);
            document.getElementById('back-btn').addEventListener('click', goBack);
            document.getElementById('quit-btn').addEventListener('click', quitGame);
            document.getElementById('hint-btn').addEventListener('click', useHint);
            document.getElementById('save-score-btn').addEventListener('click', saveScore);
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
            document.getElementById('export-ranking').addEventListener('click', exportRankingData);

            // 初始化排行榜
            updateRankingDisplay();
        });

        // 管理员登录功能
        function adminLogin() {
            const inputPwd = document.getElementById('admin-pwd').value;
            if (inputPwd === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('admin-login').classList.add('hidden');
                alert('管理员登录成功！将显示所有用户排名数据');
                showRanking();
            } else {
                alert('管理员密码错误，请重新输入');
            }
        }

        // 切换管理员登录表单显示
        function toggleAdminLogin() {
            const adminLoginForm = document.getElementById('admin-login');
            adminLoginForm.classList.toggle('hidden');
        }

        // 开始游戏
        function startGame() {
            currentQuestion = 0;
            score = 0;
            hintsUsed = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('hint-count').textContent = (2 - hintsUsed);
            loadQuestion(currentQuestion);
            
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
        }

        // 加载题目
        function loadQuestion(index) {
            if (index >= questions.length) {
                endGame();
                return;
            }
            
            const question = questions[index];
            document.getElementById('question').textContent = question.question;
            document.getElementById('question-count').textContent = `${index + 1}/${questions.length}`;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition-colors';
                optionBtn.innerHTML = `<span class="inline-block w-6 h-6 rounded-full bg-gray-200 text-center mr-2">${String.fromCharCode(65 + i)}</span>${option}`;
                optionBtn.addEventListener('click', () => checkAnswer(i, question.correct));
                optionsContainer.appendChild(optionBtn);
            });
        }

        // 检查答案
        function checkAnswer(selected, correct) {
            if (selected === correct) {
                score += 10;
                showFeedback(true);
            } else {
                score = Math.max(0, score - 5);
                showFeedback(false);
            }
            
            document.getElementById('score').textContent = score;
            currentQuestion++;
            setTimeout(() => loadQuestion(currentQuestion), 1000);
        }

        // 显示答案反馈
        function showFeedback(isCorrect) {
            const feedback = document.createElement('div');
            feedback.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-8 py-4 rounded-lg text-white font-bold text-xl z-50`;
            feedback.style.backgroundColor = isCorrect ? 'rgba(16, 185, 129, 0.9)' : 'rgba(239, 68, 68, 0.9)';
            feedback.textContent = isCorrect ? '正确！+10分' : '错误！-5分';
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 800);
        }

        // 使用提示
        function useHint() {
            if (hintsUsed >= 2) return;
            
            hintsUsed++;
            document.getElementById('hint-count').textContent = (2 - hintsUsed);
            
            const options = document.querySelectorAll('#options button');
            const correctIndex = questions[currentQuestion].correct;
            
            // 排除正确答案，随机隐藏一个错误选项
            let wrongOptions = [];
            options.forEach((opt, i) => {
                if (i !== correctIndex) wrongOptions.push(opt);
            });
            
            const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
            randomWrong.style.opacity = '0.3';
            randomWrong.disabled = true;
        }

        // 结束游戏
        function endGame() {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            document.getElementById('final-score').textContent = score;
            
            // 计算排名
            const sortedScores = [...userScores].sort((a, b) => b.score - a.score);
            let userRank = sortedScores.findIndex(s => s.name === currentUserName && s.score === score) + 1;
            
            if (!userRank) {
                // 新用户预估排名
                userRank = sortedScores.filter(s => s.score > score).length + 1;
            }
            
            document.getElementById('final-rank').textContent = `预估排名：第${userRank}名`;
        }

        // 保存分数
        function saveScore() {
            // 获取微信昵称（实际环境中可通过微信JS-SDK获取）
            currentUserName = prompt('请输入您的昵称：') || `用户${Date.now().toString().slice(-4)}`;
            
            userScores.push({
                name: currentUserName,
                score: score,
                date: new Date().toLocaleString()
            });
            
            // 去重（保留最高分）
            const uniqueUsers = {};
            userScores.forEach(user => {
                if (!uniqueUsers[user.name] || user.score > uniqueUsers[user.name].score) {
                    uniqueUsers[user.name] = user;
                }
            });
            
            userScores = Object.values(uniqueUsers);
            localStorage.setItem(RANKING_KEY, JSON.stringify(userScores));
            
            alert('成绩已保存到排行榜！');
            showRanking();
        }

        // 显示排行榜
        function showRanking() {
            endScreen.classList.add('hidden');
            startScreen.classList.add('hidden');
            rankingScreen.classList.remove('hidden');
            
            updateRankingDisplay();
        }

        // 更新排行榜显示
        function updateRankingDisplay() {
            // 管理员视图控制
            if (isAdmin) {
                document.getElementById('admin-badge').classList.remove('hidden');
                document.getElementById('admin-actions').classList.remove('hidden');
            } else {
                document.getElementById('admin-badge').classList.add('hidden');
                document.getElementById('admin-actions').classList.add('hidden');
            }
            
            // 排序分数
            const sortedScores = [...userScores].sort((a, b) => b.score - a.score);
            
            // 更新前三名
            updateTopThree(sortedScores);
            
            // 更新排行榜列表
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '';
            
            // 权限控制：普通用户只看前10名，管理员看所有
            const displayData = isAdmin ? sortedScores : sortedScores.slice(0, 10);
            
            if (displayData.length === 0) {
                rankingList.innerHTML = `
                    <div class="grid grid-cols-4 py-3 px-4 border-b border-gray-100 text-center">
                        <div class="text-gray-500">--</div>
                        <div class="col-span-2 text-gray-500">暂无排名数据</div>
                        <div class="text-gray-500">--</div>
                    </div>
                `;
                return;
            }
            
            // 渲染列表
            displayData.forEach((user, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = `grid grid-cols-4 py-3 px-4 border-b border-gray-100 text-center ${isAdmin ? 'rank-highlight' : ''}`;
                
                // 前三名特殊颜色
                let rankClass = '';
                if (index === 0) rankClass = 'text-yellow-500';
                else if (index === 1) rankClass = 'text-gray-400';
                else if (index === 2) rankClass = 'text-amber-700';
                
                rankItem.innerHTML = `
                    <div class="font-medium ${rankClass}">${index + 1}</div>
                    <div class="col-span-2 font-medium text-gray-800">${user.name}</div>
                    <div class="font-bold text-secondary">${user.score}</div>
                `;
                
                rankingList.appendChild(rankItem);
            });
            
            // 管理员显示用户总数
            if (isAdmin) {
                const totalItem = document.createElement('div');
                totalItem.className = 'grid grid-cols-4 py-3 px-4 bg-admin/5 font-medium text-admin';
                totalItem.innerHTML = `
                    <div>--</div>
                    <div class="col-span-2">用户总数</div>
                    <div>${sortedScores.length} 人</div>
                `;
                rankingList.appendChild(totalItem);
            }
        }

        // 更新前三名展示
        function updateTopThree(scores) {
            const positions = [
                { rank: 1, nameId: 'rank-1-name', scoreId: 'rank-1-score' },
                { rank: 2, nameId: 'rank-2-name', scoreId: 'rank-2-score' },
                { rank: 3, nameId: 'rank-3-name', scoreId: 'rank-3-score' }
            ];
            
            positions.forEach(pos => {
                const user = scores[pos.rank - 1];
                if (user) {
                    document.getElementById(pos.nameId).textContent = user.name;
                    document.getElementById(pos.scoreId).textContent = user.score;
                } else {
                    document.getElementById(pos.nameId).textContent = '暂无用户';
                    document.getElementById(pos.scoreId).textContent = '0';
                }
            });
        }

        // 导出排名数据（管理员功能）
        function exportRankingData() {
            if (!isAdmin) return;
            
            // 生成CSV内容
            let csvContent = "排名,用户名,分数,日期\n";
            userScores.forEach((user, index) => {
                csvContent += `${index + 1},${user.name},${user.score},${user.date}\n`;
            });
            
            // 创建下载链接
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `文学问答排行榜_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 返回按钮功能
        function goBack() {
            rankingScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        }

        // 退出游戏
        function quitGame() {
            if (confirm('确定要退出游戏吗？当前进度将不保存。')) {
                gameScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            }
        }

        // 重新挑战
        function restartGame() {
            endScreen.classList.add('hidden');
            startGame();
        }
    </script>
</body>
</html>
